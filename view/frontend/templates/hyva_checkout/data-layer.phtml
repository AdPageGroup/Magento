<?php
declare(strict_types=1);

use Magento\Framework\View\Element\Template;
use Tagging\GTM\DataLayer\Event\BeginCheckout as BeginCheckoutEvent;
use Tagging\GTM\MageWire\Component\AbstractComponent;

/** @var Template $block */
/** @var BeginCheckoutEvent $beginCheckoutEvent */
/** @var AbstractComponent $magewire */
$magewire = $block->getData('magewire');
if (false === $magewire->isHyvaCheckoutEnabled()) {
    return;
}

$beginCheckoutEvent = $block->getData('begin_checkout_event');
?>
<div>
    <script>
        function initYireoGoogleTagManagerInHyvaCheckout() {
            "use strict";

            function triggerEvent(event) {
                googleTagManager2Pusher(event.detail, 'Hyva Checkout');
            }

            triggerEvent(new CustomEvent('ga:trigger-event', {detail: <?= json_encode($beginCheckoutEvent->get()) ?>}));

            return {
                triggerEvent
            }
        }
    </script><?php if (isset($hyvaCsp) && $hyvaCsp): ?><?php $hyvaCsp->registerInlineScript() ?><?php endif; ?>
    <div id="ga-trigger"
         x-data="initYireoGoogleTagManagerInHyvaCheckout()"
         class="hidden"
         @ga:trigger-event.window="triggerEvent($event)"
    ></div>
</div>
